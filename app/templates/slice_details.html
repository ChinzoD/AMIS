{% extends "base.html" %}

{% block styles %}
    {{ super() }}
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='scripts/lightbox/ekko-lightbox.css') }}"/>
    <style>
        /* Frame */
        body{
            {#background-color: #000;#}
        }
        .slice_details{
             {#color:#fff;#}
        }
        .frame {
            height: 200px;
            line-height: 200px;
            overflow: hidden;
        }

        .frame ul {
            list-style: none;
            margin: 0;
            padding: 0;
            height: 100%;
            font-size: 50px;
        }

        .frame ul li {
            float: left;
            width: 200px;
            height: 100%;
            margin: 0 1px 0 0;
            padding: 0;
            background: #000;
            color: #ddd;
            text-align: center;
            cursor: pointer;
        }

        .frame ul li.active {
            color: #fff;
            border-top: solid 3px #0aaaf1;
            {#background: #a03232;#}
        }


        /* Scrollbar */
        .scrollbar {
            margin: 0 0 1em 0;
            height: 2px;
            background: #ccc;
            line-height: 0;
        }

        .scrollbar .handle {
            height: 100%;
            background: #0aaaf1;
            cursor: pointer;
        }

        .scrollbar .handle .mousearea {
            position: absolute;
            top: -9px;
            left: 0;
            width: 100%;
            height: 20px;
        }


        /* Controls */
        .controls {
            margin: 25px 0;
            text-align: center;
        }

        /* One Item Per Frame example*/
        .oneperframe {
            height: 300px;
            line-height: 300px;
        }

        .oneperframe ul li {
            width: 1140px;
        }

        .oneperframe ul li.active {
            background: #333;
        }

        /* Crazy example */
        .crazy ul li:nth-child(2n) {
            width: 100px;
            margin: 0 4px 0 20px;
        }

        .crazy ul li:nth-child(3n) {
            width: 300px;
            margin: 0 10px 0 5px;
        }

        .crazy ul li:nth-child(4n) {
            width: 400px;
            margin: 0 30px 0 2px;
        }


        .no-padding {
            padding: 0px;
        }

        .glyphicon-icon-rpad .glyphicon, .glyphicon-icon-rpad .glyphicon.m8, .fa-icon-rpad .fa, .fa-icon-rpad .fa.m8 {
            padding-right: 8px;
        }

        .glyphicon-icon-lpad .glyphicon, .glyphicon-icon-lpad .glyphicon.m8, .fa-icon-lpad .fa, .fa-icon-lpad .fa.m8 {
            padding-left: 8px;
        }

        .glyphicon-icon-rpad .glyphicon.m5, .fa-icon-rpad .fa.m5 {
            padding-right: 5px;
        }

        .glyphicon-icon-lpad .glyphicon.m5, .fa-icon-lpad .fa.m5 {
            padding-left: 5px;
        }

        .glyphicon-icon-rpad .glyphicon.m12, .fa-icon-rpad .fa.m12 {
            padding-right: 12px;
        }

        .glyphicon-icon-lpad .glyphicon.m12, .fa-icon-lpad .fa.m12 {
            padding-left: 12px;
        }

        .glyphicon-icon-rpad .glyphicon.m15, .fa-icon-rpad .fa.m15 {
            padding-right: 15px;
        }

        .glyphicon-icon-lpad .glyphicon.m15, .fa-icon-lpad .fa.m15 {
            padding-left: 15px;
        }


    </style>
{% endblock %}


{% block app_content %}

    <div class="container-fluid">
        <div class="row" style="max-height: 350px; height: 350px; overflow: hidden;">
            <div class="col-sm-4">
                <form>
                    <div class="form-group row">
                        <label for="gene_dropdown" class="col-sm-2 col-form-label">Gene</label>
                        <div class="col-sm-8">
                            <select name="gene" class="form-control" id="gene_dropdown">
                                {% for gene in genes %}
                                    <option value="{{ gene.name }}">{{ gene.name }}</option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>
                    <div class="form-group row">
                        <label for="organ_dropdown" class="col-sm-2 col-form-label">Organ</label>
                        <div class="col-sm-8">
                            <select name="organ" class="form-control" id="organ_dropdown">
                                {% for organ in organs %}
                                    <option value="{{ organ.name }}">{{ organ.name }}</option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>
                </form>
            </div>
            <div class="col-sm-4">
                 <div class="row form-group">
                    <div class="text-center">
                        <button type="button" class="btn btn-default">tdTomato</button>
                        <button type="button" class="btn btn-default">Dapi</button>
                        <button type="button" class="btn btn-change-color btn-default">Change Color</button>
                        <button type="button" class="btn btn-change-bg-color btn-default">Change BG Color</button>
                    </div>
                 </div>
                <div class="row text-center">
{#                        <div class="spinner-grow text-primary"></div>#}
                        <a href="" data-toggle="lightbox" data-max-width="600" class="selected_slice_a">
                            <img src="" class="selected_slice img-fluid">
                        </a>
                </div>
            </div>
            <div class="col-sm-4 slice_details">
            </div>
        </div>
        <div class="wrap">
            <div class="controls center">
                <button class="btn btn-info prev disabled" disabled=""><span class="glyphicon glyphicon-chevron-left"></span>prev</button>
                <button class="btn btn-info next">next <span class="glyphicon glyphicon-chevron-right"></span></button>
            </div>
            <div class="controls center" style="font-weight: bold;color: #0aaaf1;font-size: larger">
                (<span class="current_id"></span> of <span class="total_result"></span>)
            </div>
            <div class="scrollbar">
                <div class="handle" style="transform: translateZ(0px) translateX(0px); width: 190px;">
                    <div class="mousearea"></div>
                </div>
            </div>

            <div class="frame" id="forcecentered" style="overflow: hidden;">
                <ul class="clearfix">

                </ul>
            </div>


        </div>
    </div>
{% endblock %}

{% block scripts %}
    {{ super() }}
    <script src="{{ url_for('static', filename='scripts/sly/sly.min.js') }}"></script>
    <script src="{{ url_for('static', filename='scripts/sly/examples/js/vendor/plugins.js') }}"></script>
    <script src="{{ url_for('static', filename='scripts/lightbox/ekko-lightbox.js') }}"></script>
    <script src="{{ url_for('static', filename='scripts/lightbox/ekko-lightbox.js.map') }}"></script>
    {#    <script src="{{ url_for('static', filename='scripts/sly/horizontal.js') }}"></script>#}
    <script type="text/javascript">
        $(document).ready(function () {
            var img_color = 1;
            var bg_color = 1;
            var total_result = 0;
            var $frame = $('#forcecentered');
            var $wrap = $frame.parent();

            var slyOptions = {
                horizontal: 1,
                itemNav: 'forceCentered',
                smart: 1,
                activateMiddle: 1,
                activateOn: 'click',
                mouseDragging: 1,
                touchDragging: 1,
                releaseSwing: 1,
                startAt: 0,
                scrollBar: $wrap.find('.scrollbar'),
                scrollBy: 1,
                speed: 300,
                elasticBounds: 1,
                easing: 'easeOutExpo',
                dragHandle: 1,
                dynamicHandle: 1,
                clickBar: 1,


                // Buttons
                prev: $wrap.find('.prev'),
                next: $wrap.find('.next')
            };

            updateContent();


            $('#gene_dropdown').change(function () {
                updateContent();
            });

            $('#organ_dropdown').change(function () {
                updateContent();
            });

            function updateContent() {
                {#$('.spinner-grow').show();#}
                {#$('.selected_slice').hide();#}
                $.ajax({
                    type: 'GET',
                    url: "/slices?per_page=-1&order_by=slice_id&gene=" + $('#gene_dropdown').val() + "&organ=" + $('#organ_dropdown').val(),
                    "dataType": "json",
                    "dataSrc": "items",
                    success: function (data) {
                        var content = "";
                        total_result = 0;
                        for (i in data.items) {
                            total_result ++;
                            console.log(i);
                            content += "<li class='_"+i+"' id='" + data.items[i].id + "'><img src='" + data.items[i].img_url + "' width='200px' ></li>";
                        }
                        $('.total_result').html(total_result);
                        if(content.length == 0){
                            $('.clearfix').html("<li>N/A</li>");
                        }else{
                            $('.clearfix').html(content);
                        }

                        $frame.sly(false);
                        $frame.sly(slyOptions);
                        $frame.sly('on', 'active', function (eventName, itemIndex) {
                            console.log(eventName);
                            console.log(itemIndex);
                            frameChange(itemIndex);
                        });
                        if(img_color == 1) {
                             img_color = 2;
                        }else{
                            img_color = 1;
                        }
                        changeFilter();
                        {#$('.spinner-grow').hide();#}
                        {#$('.selected_slice').show();#}
                        if(content.length > 0){
                            frameChange(0);
                        }else{
                            frameChange(-1);
                        }

                    }, error: function (jqXHR, status, err) {
                        console.log(status);
                    }
                });
            }

            function frameChange(index) {
                if(index == -1){
                    $('.selected_slice_a').hide();
                    $('.slice_details').hide();
                    $('.current_id').html(0);
                }else{
                    if(total_result == 0){
                        $('.current_id').html(0);
                    }else {
                        $('.current_id').html(index + 1);
                    }
                    $('.selected_slice_a').show();
                    $('.slice_details').show();
                     var src = $('._'+index).find( "img" ).attr('src')+"?image=350";
                    $('.selected_slice').attr('src', src);
                    $('.selected_slice_a').attr('href', src);
                    var id = $('._'+index).attr('id');
                    updateSliceDetail(id);
                }

            }

            function updateSliceDetail(id) {
                $.ajax({
                    type: 'GET',
                    url: "/slices?id="+id,
                    "dataType": "json",
                    "dataSrc": "items",
                    success: function (data) {
                        var content = "";
                        for (i in data.items) {
                            console.log(i);
                            content += "<p><b>Organ: " + data.items[i].organ + "</b></p>";
                            content += "<p><b>Probe: " + data.items[i].gene + "</b></p>";
                             content += "<p><b>Additional Info:</b></p>";
                            content += "<div class='col-sm-5'>";
                            content += "<p>Experiment: <b>" + data.items[i].experiment + "</b></p>";
                            content += "<p>Genotype gene: <b>" + data.items[i].genotype_gene + "</b></p>";
                            content += "<p>Genotype reporter: <b>" + data.items[i].genotype_reporter + "</b></p>";
                            content += "<p>Mouse number: <b>" + data.items[i].mouse_number + "</b></p>";
                            content += "<p>Sex: <b>" + data.items[i].sex + "</b></p>";
                            content += "<p>Age: <b>" + data.items[i].age + "</b></p>";
                            content += "<p>Genetic: <b>" + data.items[i].mani_type + "</b></p>";
                            content += "<p>Uberon ref: <b>" + data.items[i].uberon + "</b></p>";
                            content += "</div><div class='col-sm-5'>";
                            content += "<p>Orientation: <b>" + data.items[i].orientation + "</b></p>";
                            content += "<p>Slide Number: <b>" + data.items[i].slide_number + "</b></p>";
                            content += "<p>Slice Number: <b>" + data.items[i].slice_id + "</b></p>";
                            content += "<p>Resolution: <b>" + data.items[i].resolution + "</b></p>";
                            content += "<p>Instrument: <b>" + data.items[i].instrument + "</b></p>";
                            content += "<p>Fluorophore: <b>" + data.items[i].wavelength + "</b></p>";
                            content += "<p>MD5: <b>" + data.items[i].checksum + "</b></p>";
                        }
                        content += "</div>";
                        $('.slice_details').html(content);
                    }, error: function (jqXHR, status, err) {
                        console.log(status);
                        $('.alert-danger .text').text(err.toLowerCase() + '!');
                        $('.alert-danger').show();
                    }
                });
            }
            function changeFilter() {
                if(img_color == 1) {
                    $("img").css('-webkit-filter', 'grayscale(1) invert(1)');
                    $(".frame li").css('background', '#fff');
                    img_color = 2;
                }else{
                    $("img").css('-webkit-filter', '');
                    $(".frame li").css('background', '#000');
                    img_color = 1;
                }
            }

            $(".btn-change-color").click(function () {
                changeFilter();
            });

            $(".btn-change-bg-color").click(function () {
                if(bg_color == 1) {
                    $("body").css('background-color', '#000');
                    $("body").css('color', '#fff');
                    bg_color = 2;
                }else{
                    $("body").css('background-color', '#fff');
                    $("body").css('color', '#000');
                    bg_color = 1;
                }
            });
        });
        $(document).on('click', '[data-toggle="lightbox"]', function(event) {
                event.preventDefault();
                $(this).ekkoLightbox();
            });
    </script>
{% endblock %}
